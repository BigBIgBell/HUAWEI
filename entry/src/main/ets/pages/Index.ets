import router from '@ohos.router';
import promptAction from '@ohos.promptAction';

// ÂÆö‰πâÁ±ªÂûã
interface TabItem {
  name: string;
  icon: string;
  page: string;
}

@Entry
@Component
struct Index {
  @State currentIndex: number = 0;
  @State showRedDot: boolean = true;

  // ÊòéÁ°ÆÁ±ªÂûãÂ£∞Êòé
  private tabs: TabItem[] = [
    { name: 'È¶ñÈ°µ', icon: 'üè†', page: 'Index' },
    { name: 'ÂØºËà™', icon: 'üó∫Ô∏è', page: 'Form' },
    { name: 'Âú∞Âõæ', icon: 'üìç', page: 'MapPage' },
    { name: 'ÊúçÂä°', icon: 'üéì', page: 'Services' }
  ];

  private banners: string[] = ['banner1', 'banner2', 'banner3'];
  private quickActions: string[] = ['Âú∞Âõæ', 'ÊàêÁª©', 'Âõæ‰π¶', 'ÊúçÂä°'];
  private copyText: string = 'Ê†°Âõ≠ÁÉ≠Á∫øÔºö400-123-4567';
  private recommendations: string[] = ['ËÆ≤Â∫ß', 'ÊØîËµõ', 'ÊãõËÅò', 'Ê¥ªÂä®', 'Êñ∞Èóª'];

  // ÂàáÊç¢Tab - Ê∑ªÂä†ÈîôËØØÂ§ÑÁêÜ
  private switchTab(index: number): void {
    try {
      this.currentIndex = index;
      const page = this.tabs[index].page;
      if (page !== 'Index') {
        // ‰ΩøÁî®Êñ∞ÁöÑÂØºËà™ÊñπÊ≥ï
        router.pushUrl({ url: `pages/${page}` });
      }
    } catch (error) {
      console.error('ÂàáÊç¢TabÈîôËØØ:', error);
    }
  }

  // ÁÇπÂáªÂø´Êç∑ÂäüËÉΩ
  private onQuickActionClick(index: number): void {
    try {
      promptAction.showToast({
        message: 'ÁÇπÂáª‰∫ÜÔºö' + this.quickActions[index],
        duration: 1500
      });

      if (index === 0) {
        router.pushUrl({ url: 'pages/MapPage' });
      } else if (index === 1 || index === 2) {
        router.pushUrl({ url: 'pages/Services' });
      }
    } catch (error) {
      console.error('Âø´Êç∑ÂäüËÉΩÁÇπÂáªÈîôËØØ:', error);
    }
  }

  // Â§çÂà∂ÊñáÊú¨
  private onCopyText(): void {
    try {
      promptAction.showToast({
        message: 'Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø',
        duration: 1500
      });
    } catch (error) {
      console.error('Â§çÂà∂ÈîôËØØ:', error);
    }
  }

  build() {
    Column() {
      // È°µÈù¢ÂÜÖÂÆπ
      Scroll() {
        Column() {
          // 1. ËΩÆÊí≠Âõæ
          Swiper() {
            ForEach(this.banners, (item: string, index: number) => {
              Column() {
                Text(item)
                  .fontSize(20)
                  .fontColor(Color.White);
              }
              .width('100%')
              .height(150)
              .backgroundColor(index === 0 ? Color.Blue :
                index === 1 ? Color.Green : Color.Red);
            }, (item: string) => item)
          }
          .width('100%')
          .height(150)
          .indicator(true)
          .loop(true);

          // 2. Ê®™ÂêëÊªöÂä®Âå∫
          Column() {
            Text('ÁÉ≠Èó®Êé®Ëçê')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .margin({ top: 20, bottom: 10 });

            Scroll() {
              Row() {
                ForEach(this.recommendations, (item: string) => {
                  Column() {
                    Text(item)
                      .fontSize(16)
                      .fontColor(Color.White);
                  }
                  .width(120)
                  .height(80)
                  .backgroundColor(Color.Blue)
                  .borderRadius(8)
                  .margin({ right: 10 })
                  .justifyContent(FlexAlign.Center);
                }, (item: string) => item)
              }
              .padding(10);
            }
            .scrollable(ScrollDirection.Horizontal)
            .height(100);
          }

          // 3. Âø´Êç∑ÂäüËÉΩÂÖ•Âè£
          Column() {
            Text('Âø´Êç∑ÂäüËÉΩ')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .margin({ top: 20, bottom: 10 });

            Grid() {
              ForEach(this.quickActions, (item: string, index: number) => {
                GridItem() {
                  Column() {
                    // ÂõæÊ†á
                    Stack() {
                      Circle({ width: 50, height: 50 })
                        .fill(Color.Blue);
                      Text(item.charAt(0))
                        .fontSize(20)
                        .fontColor(Color.White);
                    }
                    Text(item)
                      .fontSize(12)
                      .margin({ top: 5 });
                  }
                  .onClick(() => {
                    this.onQuickActionClick(index);
                  });
                }
              }, (item: string) => item)
            }
            .columnsTemplate('1fr 1fr 1fr 1fr')
            .rowsTemplate('1fr')
            .columnsGap(10)
            .rowsGap(10)
            .height(100)
            .margin({ bottom: 20 });
          }

          // 4. ÂØåÊñáÊú¨Â±ïÁ§∫Âå∫
          Column() {
            Text('Ê†°Âõ≠ÂÖ¨Âëä')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .margin({ bottom: 10 });

            Column() {
              Text('ÈáçË¶ÅÈÄöÁü•')
                .fontSize(16)
                .fontColor(Color.Red)
                .fontWeight(FontWeight.Bold);
              Text('Á≥ªÁªüÁª¥Êä§ÈÄöÁü•')
                .fontSize(14)
                .margin({ top: 5 });
              Text('Êó∂Èó¥ÔºöÂë®Êú´00:00-06:00')
                .fontSize(12)
                .fontColor(Color.Gray)
                .margin({ top: 5 });
            }
            .padding(15)
            .backgroundColor(0xF5F5F5)
            .borderRadius(8);
          }

          // 5. ÊñáÂ≠óÂ§çÂà∂ÂäüËÉΩ
          Column() {
            Text('ËÅîÁ≥ªÊñπÂºè')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .margin({ top: 20, bottom: 10 });

            Text(this.copyText)
              .fontSize(14)
              .padding(15)
              .backgroundColor(0xF5F5F5)
              .borderRadius(8)
              .onClick(() => {
                this.onCopyText();
              });
          }
        }
        .padding(20);
      }
      .flexGrow(1);

      // Â∫ïÈÉ®TabBar
      Row() {
        ForEach(this.tabs, (tab: TabItem, index: number) => {
          Column() {
            // Á∫¢ÁÇπÊ†áËÆ∞
            if (tab.name === 'ÂØºËà™' && this.showRedDot) {
              Circle({ width: 8, height: 8 })
                .fill(Color.Red)
                .position({ x: 25, y: 0 });
            }

            Text(tab.icon)
              .fontSize(20);

            Text(tab.name)
              .fontSize(12)
              .fontColor(this.currentIndex === index ? Color.Blue : Color.Gray);
          }
          .width('25%')
          .height(60)
          .justifyContent(FlexAlign.Center)
          .onClick(() => {
            this.switchTab(index);
          });
        }, (tab: TabItem) => tab.name)
      }
      .width('100%')
      .height(60)
      .backgroundColor(Color.White)
      .border({ width: 1, color: 0xE0E0E0 }); // ‰øÆÂ§çborderËØ≠Ê≥ï
    }
    .width('100%')
    .height('100%')
    .backgroundColor(Color.White);
  }
}